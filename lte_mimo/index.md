# LTE 系列：多天线技术（MIMO）


> LTE 多天线技术（MIMO）详解

<!--more-->

## 多天线技术（MIMO）

在收到信道编码后的数据（codeword）之后，物理层进一步的处理过程包括`加扰`、`调制`、`层映射`、`预编码`（precoding）以及针对各个物理天线端口的`资源映射`和 `OFDM` 信号生成的过程。

{{<image src="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/WirelessCommunication/LTE/LTE_Physical_Layer/LTE_physical_layer_9.webp" caption="物理层数据处理过程">}}

- 加扰操作是指使用扰码对经过信道编码后的数据进行**逐比特的加扰**，实现数据间**干扰的随机化**。采用**伪随机码**作为**扰码**，在每个子帧的起始位置，根据 `RNTI`（Radio Network Temporary Identifier）、`Cell ID`、`Codeword` 的编号以及无线帧内的时隙编号等信息，对扰码的 `PN 序列` 进行初始化。
- 调制指的是对比特数据进行复数调制，包括 `QPSK`、`16QAM` 或者 `64QAM`。

在完成调制后，物理层的基带处理过程将进行 MIMO 相关的处理，包括 `层映射` 和 `预编码` 。LTE Release 8 版本支持不同的发射天线数目（1 / 2 / 4），以及多种不同的 MIMO 方案，包括`单天线发送`、`空间复用`和`发送分集`。

### 层映射

层映射实现信道编码之后的**码字**（Codeword）向空间多天线形成的多个**层**（layer）之间的映射。

- 对于单天线的情况，直观地可以得到：物理层使用 1 个码字，并且这个码字直接映射到单天线的 1 个层上
- 对于多天线实现空间复用的情况，当空间复用的层数目大于 1 的时候，可以同时发送 2 个码字

> 以 4×4 天线配置的情况为例，根据无线信道的情况可以支持 1、2、3 或者 4 个层的空间复用，当空间复用的层数目大于 1 的时候，可以将 2 个码字映射在这些层上采用空间复用的方式同时进行发送。对于发送分集的情况，使用 1 个码字，按照发送天线数目的不同（2 或者 4），对应于 2 或者 4 个层，此时这 1 个码字将以逐比特转换的方式映射到这些层上。

### 预编码

预编码（precoding）实现**层**到**物理天线端口**的**映射**。物理层使用不同的预编码方案，实现不同的 `MIMO` 模式：`单天线发送`、`空间复用`或者`发送分集`。

#### 单天线发送

对于单天线发送的情况，直观的可以得出，1 个**层**将直接映射到 1 个**物理天线端口**上。

#### 空间复用

对于多天线实现空间复用的情况，LTE 中采用基于`码本`（codebook）进行预编码向量选择的机制，分为`开环`和`闭环`两种复用传输模式，分别采用`无循环延迟的预编码`和`大循环延迟的预编码`。

在 2 个发送天线的情况时，基站一般使用**线性阵列**（Uniform LinearArray，ULA）的天线配置，因此，相对应地采用基于 DFT 正交距阵的码本设计方法。

- 对应于 1 个**层**的传输，设计了 4 个可供选择的预编码向量
- 对应于 2 个**层**的传输，设计了 3 个可供选择的预编码向量。
- 对于 4 个发送天线的情况，天线的部署要更为复杂，实际情况下可能不使用线性阵列的天线配置，而采用例如双极化天线
  所以，基于对各种场景下的性能和复杂度等因素的综合考虑，选择了采用基于 `householder 变换` 的码本设计方法。对应于 1/2/3/4 个**层**的传输，均有 16 个可供选择的预编码向量。

预编码向量选取常用的两个准则：

- **信噪比最大化**，对应于容量最大化。将每个可选择的项代入，得到一个等效信道矩阵，计算等效信噪比，选择对应 SNR 最大的向量元素。
- **最小码距**，对应于最小误码率。计算信道信息给出的加权矩阵与码本中元素的距离，选择距离最小的作为预编码向量。

`无循环延迟的预编码`用于`闭环`的 MIMO 空间复用。闭环模式下，终端通过对下行信道状态的测量选择适当的空间复用的层数目，并且从码本集合中选择预编码向量，分别表示为 `RI`（Rank Indicator）和 `PMI`（Precoding Matrix Indicator）的形式**通过上行链路反馈给基站**。基站根据这些信息进行预测，确定随后的下行发送中将采用的空间复用方案（包括采用的层数目和预编码向量）。

`大循环延迟的预编码`用于`开环`的 MIMO 空间复用。开环模式下，终端**不再向基站反馈**预编码向量 `PMI` 的信息，但仍可以根据基站的配置测量并且**反馈**下行信道的 `RI` 信息，即空间复用的层数目。基站根据终端上报的 `RI` 信息或者自行确定的层数目，选择在下行发送中所采用的预编码方案，包括采用发送分集，或者空间复用以及相应的层数目。

在开环空间复用中，采用的预编码向量是**固定**的。

- 在使用 2 个发送天线的情况下
  - 当选择层数目 RI=1 时，采用发送分集的预编码方案。
  - 当选择 RI=2 时，采用对应码本的第一个元素，即 $W(i)=\frac{1}{\sqrt{2}}\begin{bmatrix}1&0 \\\ 0&1\end{bmatrix}$ 作为预编码向量。
- 在使用 4 个发送天线的情况下
  - 当选择层数目 RI=1 时，采用发送分集的预编码方案
  - 当选择 RI=2/3/4 时，采用对应的码本，以发送时刻为单位，固定的循环使用码本中序号为 12/13/14/15 的元素作为预编码向量。

对于`大循环延迟的预编码`，除了预编码向量 $W (i)$ 之外，有两个用于完成循环延迟（Cyclic Delay Diversity，CDD）功能的矩阵，即 $U$ 和 $D (i)$。

假设层数目为 v，那么这两个矩阵的大小都是 $v×v$ 的，其中

- $U$ 是 `DFT 矩阵`，通过对输入信号进行 `DFT` 变换实现`层`到`虚拟天线`的映射，将每个层的信号能量均匀地分布在虚拟天线上
- $D (i)$是 `CDD 矩阵`，实现虚拟天线间增量为 $\frac{1}{v}$ 的时延。

#### 发送分集

对于多天线实现发送分集的情况，分别采用 `SFBC`（Space Frequency Block Codiing）和 `SFBC+FSTD`（Frequency Switched Transmit Diversity）的方案支持 2 和 4 个发送天线的场景。

- 在 2 个发送天线时，使用 SFBC 的发送分集方案，实现“层”到物理天线映射的预编码操作。

{{<image src="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/WirelessCommunication/LTE/LTE_Physical_Layer/LTE_physical_layer_10.webp" caption="SFBC 发送分集">}}

- 在 4 个发送天线时，使用 SFBC+FSTD 的发送分集方案。相应地，实现层到物理天线映射的预编码操作可以表示为下图所示的形式，即 SFBC 结合 FSTD 在天线间频域的位置转换。

{{<image src="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/WirelessCommunication/LTE/LTE_Physical_Layer/LTE_physical_layer_11.webp" caption="SFBC+FSTD 发送分集">}}

## 参考

- [1] LTE-Advanced 关键技术详解

